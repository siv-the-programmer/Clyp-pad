/* ─── RESET & VARS ─────────────────────────────────────────── */
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#0b0b0e;
  --s1:#111115;
  --s2:#18181e;
  --s3:#222229;
  --s4:#2c2c36;
  --border:rgba(255,255,255,0.07);
  --border2:rgba(255,255,255,0.14);
  --text:#eaeaf0;
  --sub:#6a6a80;
  --dim:#38384a;
  --blue:#4f8fff;
  --blue-a:rgba(79,143,255,0.12);
  --green:#2fd17a;
  --red:#f05858;
  --amber:#f5a623;
  --purple:#9b6fff;
  --pink:#ff6eb4;
  --yellow:#ffd060;
  --font:'DM Sans',system-ui,sans-serif;
  --mono:'JetBrains Mono',ui-monospace,monospace;
}

html,body{width:100%;height:100%;overflow:hidden;background:var(--bg);color:var(--text);font-family:var(--font);-webkit-font-smoothing:antialiased;touch-action:none;user-select:none}

/* ─── GOOGLE FONTS ──────────────────────────────────────────── */
@import url('https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap');

/* ─── STAGE / CANVAS ─────────────────────────────────────────── */
#stage{position:fixed;inset:0;overflow:hidden;cursor:default}
#grid-cvs{position:absolute;inset:0;pointer-events:none}
#world{position:absolute;top:0;left:0;transform-origin:0 0;will-change:transform;backface-visibility:hidden}

/* ─── TOPBAR ─────────────────────────────────────────────────── */
#topbar{
  position:fixed;top:0;left:0;right:0;height:50px;
  display:flex;align-items:center;gap:8px;padding:0 14px;
  background:rgba(11,11,14,0.94);backdrop-filter:blur(20px);
  border-bottom:1px solid var(--border);z-index:200
}
.logo{font-size:15px;font-weight:800;letter-spacing:-.6px;flex-shrink:0;white-space:nowrap}
.logo em{color:var(--blue);font-style:normal}
#back-btn{
  display:none;align-items:center;gap:5px;padding:0 10px;height:28px;
  border-radius:8px;border:1px solid var(--border);background:var(--s2);
  color:var(--sub);font:600 12px var(--font);cursor:pointer;transition:all .12s;flex-shrink:0
}
#back-btn:hover{background:var(--s3);color:var(--text)}
#bc{display:flex;align-items:center;gap:4px;flex:1;min-width:0;overflow:hidden}
.bc-node{font-size:12px;color:var(--sub);cursor:pointer;white-space:nowrap;transition:color .12s;max-width:130px;overflow:hidden;text-overflow:ellipsis}
.bc-node:hover{color:var(--text)}
.bc-node.cur{color:var(--text);font-weight:700;cursor:default}
.bc-sep{color:var(--dim);font-size:11px;flex-shrink:0}
.top-right{display:flex;align-items:center;gap:6px;flex-shrink:0}
#zoom-lbl{font-size:11px;font-family:var(--mono);color:var(--sub);padding:3px 8px;background:var(--s2);border:1px solid var(--border);border-radius:6px;cursor:pointer;transition:color .12s;white-space:nowrap}
#zoom-lbl:hover{color:var(--text)}
.top-btn{padding:0 10px;height:28px;border-radius:8px;border:1px solid var(--border);background:var(--s2);color:var(--sub);font:600 11px var(--font);cursor:pointer;transition:all .12s;white-space:nowrap}
.top-btn:hover{background:var(--s3);color:var(--text)}

/* workspace switcher */
#ws-bar{display:flex;align-items:center;gap:3px;padding:3px;background:var(--s2);border:1px solid var(--border);border-radius:9px}
.ws-btn{padding:0 10px;height:22px;border-radius:6px;border:none;background:transparent;color:var(--sub);font:600 11px var(--font);cursor:pointer;transition:all .12s;white-space:nowrap}
.ws-btn.active{background:var(--blue);color:#fff}
.ws-btn:not(.active):hover{background:var(--s3);color:var(--text)}

/* ─── TOOLBAR ─────────────────────────────────────────────────── */
#toolbar{
  position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
  display:flex;align-items:center;gap:2px;padding:5px 6px;
  background:rgba(11,11,14,0.96);backdrop-filter:blur(24px);
  border:1px solid var(--border2);border-radius:14px;
  box-shadow:0 8px 40px rgba(0,0,0,.7);z-index:200;
  max-width:calc(100vw - 24px);overflow-x:auto;overflow-y:hidden
}
#toolbar::-webkit-scrollbar{display:none}
.tb{
  display:inline-flex;align-items:center;gap:4px;padding:0 9px;height:30px;
  border-radius:8px;font:600 11.5px var(--font);cursor:pointer;
  border:1px solid transparent;background:transparent;color:var(--sub);
  transition:all .12s;white-space:nowrap;flex-shrink:0
}
.tb:hover{background:var(--s2);color:var(--text)}
.tb:active{transform:scale(.94)}
.tb.accent{background:var(--blue);color:#fff;border-color:var(--blue)}
.tb.accent:hover{background:#3a7bf0}
.tb.active{color:var(--blue)}
.tb-sep{width:1px;height:16px;background:var(--border);margin:0 1px;flex-shrink:0}

/* ─── CARDS ─────────────────────────────────────────────────────── */
.card{
  position:absolute;border-radius:11px;background:var(--s1);
  border:1.5px solid var(--border);cursor:grab;
  transform:translateZ(0);backface-visibility:hidden;
  transition:border-color .14s,box-shadow .14s
}
.card:hover{border-color:var(--border2);box-shadow:0 6px 28px rgba(0,0,0,.45)}
.card.sel{border-color:var(--blue)!important;box-shadow:0 0 0 2.5px rgba(79,143,255,.2),0 8px 32px rgba(0,0,0,.5)!important}
.card.dragging{cursor:grabbing;box-shadow:0 22px 60px rgba(0,0,0,.75)!important;z-index:500;transition:none}

/* note */
.cn{min-width:180px;min-height:80px;display:flex;flex-direction:column;overflow:hidden}
.cn-head{padding:11px 13px 4px;flex-shrink:0}
.cn-title{font-size:12.5px;font-weight:700;color:var(--text);line-height:1.3;word-break:break-word}
.cn-body{font-size:11.5px;color:var(--sub);line-height:1.6;word-break:break-word;overflow:hidden;flex:1;padding:0 13px 10px}
.cn-foot{font-size:9px;color:var(--dim);padding:5px 13px;border-top:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:space-between}
.cn-edit{font-size:9px;color:var(--blue);cursor:pointer;opacity:0;transition:opacity .12s;background:none;border:none;font-family:var(--font);font-weight:600;padding:0}
.card:hover .cn-edit{opacity:1}

/* folder */
.cf{min-width:150px;padding:14px;display:flex;flex-direction:column;gap:9px;background:linear-gradient(135deg,var(--s2),var(--s1));border-color:rgba(79,143,255,.18)}
.cf-ico{width:38px;height:38px;border-radius:9px;background:rgba(79,143,255,.1);border:1px solid rgba(79,143,255,.2);display:grid;place-items:center;font-size:18px}
.cf-name{font-size:12.5px;font-weight:700;color:var(--text);word-break:break-word}
.cf-meta{font-size:10px;color:var(--sub)}
.cf-hint{font-size:9.5px;color:var(--blue);opacity:0;transition:opacity .15s;font-weight:700}
.cf:hover .cf-hint{opacity:1}

/* label */
.cl{background:transparent;border-color:transparent;cursor:grab;padding:6px 28px 18px 10px;width:max-content;min-width:30px}
.cl:hover{border-color:var(--border);background:rgba(255,255,255,.02)}
.cl-text{font-weight:800;line-height:1.2;white-space:nowrap;display:block;pointer-events:none}
/* always show resize on hover, plus edit btn */
.cl .rh{display:flex!important;opacity:0;transition:opacity .12s}
.cl:hover .rh,.cl.sel .rh{opacity:1}
.cl-edit{position:absolute;top:4px;right:20px;font-size:9px;color:var(--blue);cursor:pointer;opacity:0;transition:opacity .12s;background:none;border:none;font-family:var(--font);font-weight:700;padding:0}
.cl:hover .cl-edit{opacity:1}

/* sticky */
.cs{min-width:160px;min-height:90px;display:flex;flex-direction:column;overflow:hidden}
.cs-inner{flex:1;padding:12px;font-size:12px;line-height:1.6;color:#1a1a1a;word-break:break-word;overflow:hidden}
.cs-foot{font-size:9px;padding:4px 10px;opacity:.5;flex-shrink:0;color:#1a1a1a;display:flex;align-items:center;justify-content:space-between}
.cs-edit{font-size:9px;color:#333;cursor:pointer;opacity:0;transition:opacity .12s;background:none;border:none;font-family:var(--font);font-weight:700;padding:0}
.card:hover .cs-edit{opacity:.7}

/* checklist */
.cch{min-width:200px;padding:12px;display:flex;flex-direction:column;gap:5px;overflow:hidden}
.cch-title{font-size:12.5px;font-weight:700;color:var(--text);margin-bottom:4px}
.cch-item{display:flex;align-items:flex-start;gap:7px;font-size:12px;color:var(--sub);line-height:1.4}
.cch-box{width:14px;height:14px;border-radius:4px;border:1.5px solid var(--border2);flex-shrink:0;margin-top:1px;cursor:pointer;display:grid;place-items:center;transition:all .12s}
.cch-box.done{background:var(--green);border-color:var(--green)}
.cch-box.done::after{content:'✓';font-size:9px;color:#fff}
.cch-item.done-item .cch-lbl{text-decoration:line-through;opacity:.4}

/* link */
.clk{min-width:200px;padding:12px 13px;display:flex;flex-direction:column;gap:5px}
.clk-title{font-size:12.5px;font-weight:700;color:var(--text)}
.clk-url{font-size:10px;color:var(--blue);word-break:break-all;cursor:pointer;text-decoration:underline}
.clk-desc{font-size:11px;color:var(--sub);line-height:1.5}

/* shape */
.cshp{background:transparent!important;border:1.5px solid transparent!important;padding:0;overflow:visible;cursor:grab}
.cshp:hover{border-color:var(--border)!important}
.cshp.sel{border-color:var(--blue)!important}
.cshp svg{display:block;overflow:visible;pointer-events:none}

/* media */
.cmed{min-width:180px;padding:0;overflow:hidden}
.cmed img,.cmed video{width:100%;display:block;border-radius:9px 9px 0 0;max-height:260px;object-fit:cover;pointer-events:none}
.cmed video{pointer-events:auto}
.cmed-cap{padding:7px 11px;font-size:11px;color:var(--sub);border-top:1px solid var(--border)}

/* voice */
.cvoc{min-width:210px;padding:12px;display:flex;flex-direction:column;gap:8px}
.cvoc-top{display:flex;align-items:center;gap:10px}
.cvoc-ico{width:34px;height:34px;border-radius:8px;background:rgba(155,111,255,.12);border:1px solid rgba(155,111,255,.22);display:grid;place-items:center;font-size:16px;flex-shrink:0}
.cvoc-name{font-size:12px;font-weight:700;color:var(--text)}
.cvoc-dur{font-size:10px;color:var(--sub)}
.cvoc-bars{display:flex;align-items:center;gap:2px;height:22px;overflow:hidden}
.cvoc-bars span{width:3px;border-radius:2px;background:var(--purple);flex-shrink:0}
.vplay{width:28px;height:28px;border-radius:7px;border:1px solid var(--border);background:var(--s2);color:var(--text);font-size:11px;cursor:pointer;display:grid;place-items:center;transition:background .12s}
.vplay:hover{background:var(--s3)}

/* resize handle */
.rh{position:absolute;right:2px;bottom:2px;width:16px;height:16px;cursor:se-resize;display:none;align-items:flex-end;justify-content:flex-end;padding:2px;z-index:10;border-radius:3px}
.card:hover .rh,.card.sel .rh{display:flex}
.rh svg{opacity:.3;transition:opacity .12s}
.rh:hover svg{opacity:.8}
/* special: shape resize always visible when hovered/selected */
.cshp:hover .rh,.cshp.sel .rh{display:flex}

/* edit overlay button (top-right of card) */
.card-edit-btn{
  position:absolute;top:5px;right:5px;width:22px;height:22px;
  border-radius:6px;border:1px solid var(--border);background:var(--s2);
  color:var(--sub);font-size:11px;cursor:pointer;display:none;
  align-items:center;justify-content:center;z-index:10;transition:all .12s
}
.card:hover .card-edit-btn{display:flex}
.card-edit-btn:hover{background:var(--s3);color:var(--text)}

/* ─── TEMPLATES PANEL ─────────────────────────────────────────── */
#tpl-panel{
  position:fixed;left:0;top:50px;bottom:0;width:230px;
  background:rgba(11,11,14,0.97);backdrop-filter:blur(20px);
  border-right:1px solid var(--border);z-index:150;
  transform:translateX(-100%);transition:transform .22s cubic-bezier(.4,0,.2,1);
  display:flex;flex-direction:column
}
#tpl-panel.open{transform:translateX(0)}
.tpl-hd{padding:12px 14px 8px;border-bottom:1px solid var(--border);font-size:13px;font-weight:700;flex-shrink:0}
.tpl-list{flex:1;overflow-y:auto;padding:6px 6px 90px}
.tpl-list::-webkit-scrollbar{width:3px}
.tpl-list::-webkit-scrollbar-thumb{background:var(--s3);border-radius:2px}
.tpl-sec{font-size:9.5px;font-weight:700;letter-spacing:.08em;text-transform:uppercase;color:var(--dim);padding:10px 6px 3px}
.tpl-item{display:flex;align-items:center;gap:9px;padding:7px 8px;border-radius:8px;cursor:pointer;transition:background .1s;margin-bottom:1px}
.tpl-item:hover{background:var(--s2)}
.tpl-item:active{background:var(--s3)}
.tpl-ico{width:30px;height:30px;border-radius:7px;display:grid;place-items:center;font-size:14px;flex-shrink:0}
.tpl-name{font-size:12px;font-weight:600;color:var(--text)}
.tpl-desc{font-size:10px;color:var(--sub)}

/* ─── CONTEXT MENU ─────────────────────────────────────────────── */
#ctx{
  position:fixed;z-index:600;background:#14141b;
  border:1px solid var(--border2);border-radius:11px;padding:5px;
  min-width:175px;display:none;box-shadow:0 18px 55px rgba(0,0,0,.8);
  animation:ctx-in .1s ease
}
@keyframes ctx-in{from{opacity:0;transform:scale(.92)}to{opacity:1;transform:scale(1)}}
.ctx-row{
  display:flex;align-items:center;gap:8px;padding:7px 9px;
  border-radius:7px;font-size:12.5px;color:var(--text);cursor:pointer;transition:background .08s
}
.ctx-row:hover{background:rgba(255,255,255,.06)}
.ctx-row.red{color:var(--red)}
.ctx-row.red:hover{background:rgba(240,88,88,.1)}
.ctx-sep{height:1px;background:var(--border);margin:3px 0}

/* ─── MODALS ─────────────────────────────────────────────────────── */
.mbg{
  position:fixed;inset:0;background:rgba(0,0,0,.75);backdrop-filter:blur(6px);
  display:none;align-items:center;justify-content:center;z-index:400;padding:16px
}
.mbg.open{display:flex}
.mbox{
  background:#131319;border:1px solid var(--border2);border-radius:14px;
  overflow:hidden;box-shadow:0 28px 70px rgba(0,0,0,.85);
  animation:m-in .15s ease;width:100%
}
@keyframes m-in{from{transform:scale(.94);opacity:0}to{transform:scale(1);opacity:1}}
.mhd{display:flex;align-items:center;padding:13px 15px;border-bottom:1px solid var(--border);gap:8px}
.mhd-title{flex:1;font-size:14px;font-weight:700}
.mcl{width:26px;height:26px;border-radius:7px;border:none;background:var(--s2);color:var(--sub);font-size:14px;cursor:pointer;display:grid;place-items:center;transition:all .1s}
.mcl:hover{background:var(--s3);color:var(--text)}
.mbd{padding:15px;display:flex;flex-direction:column;gap:12px}
.mft{display:flex;gap:7px;padding:0 15px 15px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:0 13px;height:32px;border-radius:8px;font:600 12px var(--font);cursor:pointer;border:1px solid var(--border);background:var(--s2);color:var(--text);transition:all .12s}
.btn:hover{background:var(--s3)}
.btn.blue{background:var(--blue);border-color:var(--blue);color:#fff}
.btn.blue:hover{background:#3a7bf0}
.mlbl{font-size:10px;color:var(--sub);text-transform:uppercase;letter-spacing:.07em;margin-bottom:4px;display:block}
.minput{width:100%;padding:8px 11px;border-radius:8px;border:1.5px solid var(--blue);background:rgba(255,255,255,.04);color:var(--text);font:13.5px var(--font);outline:none}
.minput::placeholder{color:var(--dim)}
.mta{width:100%;min-height:80px;padding:9px 11px;border-radius:8px;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--text);font:13px/1.65 var(--font);outline:none;resize:vertical}
.mta:focus,.minput:focus{border-color:var(--blue)}
.msel{width:100%;padding:8px 11px;border-radius:8px;border:1px solid var(--border);background:var(--s2);color:var(--text);font:13px var(--font);outline:none;cursor:pointer}
.mrow2{display:grid;grid-template-columns:1fr 1fr;gap:10px}

/* editor modal */
#ed-modal{max-width:820px;height:min(640px,90vh);display:flex;flex-direction:column}
#ed-modal .mbd{flex:1;padding:0;min-height:0}
#ed-ta{
  flex:1;width:100%;height:100%;background:transparent;border:none;outline:none;
  resize:none;color:var(--text);font:14px/1.85 var(--mono);padding:18px 22px;
  caret-color:var(--blue)
}
#ed-ta::placeholder{color:var(--dim)}
#ed-ta::selection{background:rgba(79,143,255,.2)}
#ed-nm{flex:1;background:transparent;border:none;outline:none;font:700 14px var(--font);color:var(--text);caret-color:var(--blue);min-width:0}
#ed-dot{width:6px;height:6px;border-radius:50%;background:transparent;transition:background .3s;flex-shrink:0}
#ed-dot.dirty{background:var(--amber)}
#ed-dot.saved{background:var(--green)}
#ed-stat{font-size:10px;color:var(--dim);font-family:var(--mono)}

/* swatch picker */
.sw-row{display:flex;gap:6px;flex-wrap:wrap}
.sw{width:26px;height:26px;border-radius:7px;cursor:pointer;border:2px solid transparent;transition:transform .1s,border-color .1s;flex-shrink:0}
.sw:hover{transform:scale(1.12)}
.sw.on{border-color:#fff!important}

/* ─── COLOR PICKER POPUP ────────────────────────────────────────── */
#cpick{
  position:fixed;z-index:800;background:#14141b;
  border:1px solid var(--border2);border-radius:11px;padding:10px;
  display:none;box-shadow:0 12px 40px rgba(0,0,0,.8);
}
#cpick .sw-row{max-width:160px}

/* ─── SHAPE GRID ──────────────────────────────────────────────── */
#shp-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:7px}
.shp-btn{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:3px;padding:8px 4px;border-radius:9px;border:1.5px solid var(--border);
  background:var(--s2);color:var(--text);cursor:pointer;font-size:18px;
  transition:all .1s
}
.shp-btn:hover{background:var(--s3)}
.shp-btn.on{border-color:var(--blue);background:var(--blue-a)}
.shp-btn span{font-size:9px;color:var(--sub)}

/* ─── MEDIA DROP ──────────────────────────────────────────────── */
#media-drop{
  border:2px dashed var(--border2);border-radius:12px;padding:28px;
  text-align:center;cursor:pointer;transition:all .15s
}
#media-drop:hover,#media-drop.drag-over{border-color:var(--blue);background:var(--blue-a)}

/* ─── VOICE MODAL ─────────────────────────────────────────────── */
#waveform{height:44px;background:var(--s2);border-radius:10px;display:flex;align-items:center;justify-content:center;gap:2px;padding:0 8px;overflow:hidden}
#rec-dot{width:10px;height:10px;border-radius:50%;background:var(--dim);transition:background .3s;flex-shrink:0}
#rec-time{font-size:30px;font-weight:800;font-family:var(--mono);letter-spacing:-1px}
#rec-hint{font-size:11.5px;color:var(--sub);margin-top:2px}

/* ─── TOAST ────────────────────────────────────────────────────── */
#toast{
  position:fixed;bottom:72px;left:50%;transform:translateX(-50%) translateY(8px);
  padding:8px 16px;border-radius:20px;background:rgba(18,18,26,.97);
  border:1px solid var(--border2);font-size:12.5px;font-weight:600;color:var(--text);
  opacity:0;transition:opacity .2s,transform .2s;pointer-events:none;
  white-space:nowrap;z-index:700;box-shadow:0 8px 28px rgba(0,0,0,.6)
}
#toast.show{opacity:1;transform:translateX(-50%) translateY(0)}



/* ─── RESPONSIVE ──────────────────────────────────────────────── */
@media(max-width:600px){
  .tb{padding:0 7px;font-size:11px;height:28px}
  #tpl-panel{width:100%}
  #ed-ta{font-size:16px}
}